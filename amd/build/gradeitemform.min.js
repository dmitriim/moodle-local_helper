define ("local_helper/gradeitemform",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui"],function(a,b,c,d,e,f,g){var h=function(a,b){this.contextid=b;this.init(a)};h.prototype.modal=null;h.prototype.contextid=-1;h.prototype.id=0;h.prototype.courseid=0;h.prototype.init=function(b){var f=a(b);this.buttonId="ressubmit_item";this.finalexam=!1;if(-1!=b.search("final")){this.finalexam=!0;this.buttonId="submit_finalexam"}f.on("click",function(b){var e=a(b.currentTarget);return c.create({type:c.types.SAVE_CANCEL,title:"",body:""},f).then(function(a){this.modal=a;this.modal.setRemoveOnClose(!0);this.id=e.attr("data-id");this.courseid=e.attr("data-courseid");this.action=e.attr("data-action");this.modal.setBody(this.getBody());var b="Unknown Item";switch(this.action){case"createitemmodal":b="On click example 1";break;case"createfinalmodal":b="On click example 2";break;}this.modal.setTitle(b);this.modal.setLarge();this.modal.getRoot().on(d.shown,function(){this.modal.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this));this.modal.getRoot().on(d.save,this.submitForm.bind(this));this.modal.getRoot().on("submit","form",this.submitFormAjax.bind(this));this.modal.getRoot().on(d.cancel,this.resetFormDirtyState.bind(this));this.modal.getRoot().on("click",".close",this.resetFormDirtyState.bind(this));this.modal.getRoot().find("[data-action=\"save\"]").attr("id",this.buttonId);return this.modal}.bind(this))}.bind(this))};h.prototype.getBody=function(a){if("undefined"==typeof a){a={id:this.id,courseid:this.courseid,finalexam:this.finalexam}}var b={jsonformdata:JSON.stringify(a)};return e.loadFragment("local_helper","item_form",this.contextid,b)};h.prototype.handleFormSubmissionResponse=function(){this.modal.hide();this.resetFormDirtyState()};h.prototype.handleFormSubmissionFailure=function(a){this.toggleSubmitButton();this.modal.setBody(this.getBody(a))};h.prototype.submitFormAjax=function(a){a.preventDefault();this.toggleSubmitButton();var b=this.modal.getRoot().find("form").serialize();if(this.finalexam){b+="&hidden=1"}f.call([{methodname:"dummy_method",args:{contextid:this.contextid,jsonformdata:JSON.stringify(b)},done:this.handleFormSubmissionResponse.bind(this,b),fail:this.handleFormSubmissionFailure.bind(this,b)}])};h.prototype.submitForm=function(a){a.preventDefault();this.modal.getRoot().find("form").submit()};h.prototype.resetFormDirtyState=function(){g.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});this.modal.destroy()};h.prototype.toggleSubmitButton=function(){var a=document.getElementById(this.modal.getRoot().find("[data-action=\"save\"]").attr("id"));if(a.disabled){a.disabled=!1}else{a.disabled=!0}};return{init:function init(a,b){return new h(a,b)}}});
//# sourceMappingURL=gradeitemform.min.js.map
